<div class="request">
  <h2><%= @request.status.capitalize %> Rental Request from <%= @request.user.user_name %></h2>

  <h4>Property: <%= @place.title %></h4>
  <h4>Owner: <%= @place.owner.user_name %></h4>
  <h4>Check In: <%= @request.begin_date.strftime("%m/%d/%Y") %></h4>
  <h4>Check Out: <%= @request.end_date.strftime("%m/%d/%Y") %></h4>
</div>

<a href="#new_message" role="button" class="btn" data-toggle="modal" id="message_button">Send Owner A Message</a>

<div id="new_message" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
    <h3 id="myModalLabel">Message To: <%= current_user.id == @place.owner.id ? @request.user.user_name : @place.owner.user_name %></h3>
  </div>

  <div class="modal-body">
    <form class="message_send_forms">
      <label for="title">Message Title:</label><br>
      <input type="text" id="title" name="message[title]" class="modal-text"><br>

      <label for="body">Message:</label><br>
      <textarea id="body" name="message[message]" class="modal-text modal-textarea"></textarea><br>

      <input type="hidden" name="message[reciever_id]" value="<%= current_user.id == @place.owner.id ? @request.user_id : @place.owner_id %>">

      <input type="hidden" name="thread" value="false">

      <input type="hidden" name="authenticity_token" value="<%= form_authenticity_token %>">
    </form>
  </div>

  <div class="modal_footer">
    <button id="send" class="btn btn-primary buffer" data-dismiss="modal" aria-hidden="true">Send</button>
  </div>
</div>

<script type="text/javascript">
 $('#send').on('click', function(){
      var messageFormData = $('.message_send_forms').serializeJSON();
      $.ajax({
        url: "/messages",
        type: "post",
        data: messageFormData,
        success: function(){
          console.log('yup');
          $('.request').append("<h5>Message Sent</h5>");
        },
        error: function(){
          console.log('nope');
          $('.request').append("<h5>Message Not Sent</h5>");
        }
      })
    })
</script>